## 概述

### 插件介绍

核心插件：

◆Drill_CoreOfBallistics 系统 - 弹道核心

子插件：

◆Drill_CoreOfGaugeMeter 系统 - 参数条核心

◆Drill_CoreOfShatterEffect 系统 - 方块粉碎核心

◆Drill_CoreOfSelectableButton 系统 - 按钮组核心

◆Drill_STG__core STG - 引擎

**弹道：**是指能够描述 单个或一群
粒子/碎片/子弹运动的轨迹，是程序经过**数学计算**后的结果数据集。此定义与实际的弹道学有一些区别。

![](media/0aae86e8169628ea8e57a9912b5c7fa3.png)

**弹道模式：**指用于描述弹道的各种配置方法。如下图：

由于弹道同时涉及 数学公式和代码定义
，且许多插件都基于弹道移动，所以此文档需要全文反复学习。（多次简单过目该文档即可）

### 插件关系

弹道核心属于数学计算，服务于其他的核心或一般插件，关系如下：

## 弹道模式

相关 子插件 会根据自身特殊的情况，

提供部分模式的设置，但不一定会提供所有弹道模式的支持。

![](media/4e576bf0e2185de94b7fc906fdf64f32.png)

### 直角坐标模式

直角坐标模式通过 x速度 + y速度 控制轨迹。

时间、速度已知，路程未知。

| **X速度(vx)**：正数向右，负数向左。单位 像素/帧。见 [类型 - 速度](#_类型_-_速度) 。 **Y速度(vy)**：正数向下，负数向上。单位 像素/帧。见 [类型 - 速度](#类型---速度) 。 （注意，y速度正数向下，是反的。） |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

![](media/f628a42c75139e6cdca368c58faefb16.png)

### 极坐标模式

极坐标模式通过 速度+方向 控制轨迹。

时间、速度已知，路程未知。

| **速度(v)**：正数沿着方向移动，负数反向移动。单位 像素/帧。见 [类型 - 速度](#类型---速度) 。 **方向(θ)**：0朝向右，90朝下，-90朝上，顺时针规律。单位 角度。见 [类型 - 方向](#_类型_-_方向) 。 （可以写超过360的数。390度与30度的方向一样。） |
|----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

![F:\\rpg mv箱\\弹道\\关于弹道1.png](media/21e317189b43b94aaceb0ff0a1791181.png)

### 轨道锚点模式

轨道锚点模式中，轨迹是固定的，通过速度，来确定在轨迹中的具体位置。

简单来说，就好比铺火车轨道，无论火车如何加速减速，都一定按照固定轨道到移动，不可能脱轨移动。

设置锚点 = 铺火车轨道

设置速度 = 火车速度变化

| **速度(v)**：正数沿着轨道移动，不支持负数。单位 像素/帧。见 [类型 - 速度](#类型---速度) 。 **轨道锚点**：绘制固定的锚点列表。单位像素。见 [类型 - 轨道锚点](#_类型_-_轨道锚点) 。 （只适合单个粒子移动，多个粒子移动效果不明显。） |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

![](media/ffe43f12a0366ba92b6be16d42557d43.png)
![](media/1f9d849017a984e11523c0f4c8677b57.png)

### 两点式

两点式通过 固定模式+目标点 控制轨迹。

时间、路程已知，速度未知。

**起始点：**粒子移动前所在的位置。

**目标点：**分为绝对坐标与相对坐标，用于计算当前物体到目标物体的路程。

| **固定模式：**由于时间和路程是固定量，只有速度是可控制变量。 根据速度的不同变化方式，可分成多种模式。见 [类型 - 两点式](#_类型_-_两点式) 。 （只适合 单个对象 移动，多个对象 会重叠。） |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

![](media/69a6cc853e9bbc7447905109c351240a.png)

## 参数类型

### 类型 - 速度

**1）初速度**

公式参数名：p.v0 。

速度1，表示 1像素/帧。 速度1.5，表示 1.5像素/帧。

速度可以为负数，表示反方向移动。

只有初速度时，表示匀速运动，可见：[公式：只初速度](#公式只初速度)。

![](media/59618b7bc9285a05978f7040ea1bef04.png)

**2）随机波动量**

公式参数名：p.wave 。

在粒子的速度的基础上，添加/减少的随机速度量。

比如，初速度为10，波动量为8，那么速度为：6\~14之间。（10-4 \~ 10+4）

初速度+波动量 仍然为匀速运动，可见：[公式：初速度+波动量](#公式初速度波动量)。

![](media/56fd1f8d249d8e71ee2769b3f3dcdf26.png)

**3）加速度**

公式参数名：p.a 。

粒子在运动过程中，速度逐渐改变的加速度值。

极坐标模式中：无论加速度如何变化，都**不会**影响运动方向。

直角坐标模式中：如果vy的加速度化和vx的加速度**不一样**，那么就会间接改变这个粒子的实际方向。比如，vx匀速+vy匀加速
= 抛物线。

![](media/7e11507c423a5071498c1b253e4aa0a6.png)

**4）速度最大/最小值**

公式参数名：p.vMax p.vMin 。

设置限制后，无论速度如何变化，都会保持在最大速度和最小速度之内。

比如，一个不断减速的粒子，如果设置了最小速度0，则会停下来。否则粒子速度将会越来越小，变成负数，朝反方向开始移动。

**5）路程计算公式**

见后面的章节 [路程计算公式](#路程计算公式) 。

### 类型 - 方向

**1）方向单位**

主要方向单位为 角度 ，部分设置里面可能会使用弧度，360（角度）= 2π（弧度）。

如果特殊情况要求输入弧度时，可用3.14代替π。

**2）四周扩散**

四周扩散，即以中心点为基准，方向随机。

![](media/6f9ca0d220b8e423944b1894e3e41b59.png)

**3）扇形范围**

图中的朝向的角度为0，90度朝下，-90朝上，顺时针规则。

扇形角度为360时 = 四周扩散

![](media/6b64da4ff6b8a07246693ab204f41751.png)

![](media/d2533e3f700867c72de29bdb906fe952.png)

**4）方向计算公式**

见后面的章节 [方向计算公式](#方向计算公式) 。

### 类型 - 轨道锚点

**1）锚点列表**

这里的轨道，可以通过弹道绘制器绘制出来，从而形成锚点列表。

子弹会根据锚点列表描绘的轨迹，依次进行轨道移动。

![](media/05a70fa70f5da7ca511a8c450a7f5a62.png)

![](media/1fbaa742422be10f7d38f534cdbb0308.png)

![](media/f8b36a7d063c48021b38dd5f247089d8.png)

**2）限时问题**

注意，虽然粒子会按照指定的轨道移动，但是粒子 不一定会 走完全部轨道。

粒子的移动时间结束后，粒子会 **停在** 当前的位置。

![](media/9ff7cb16c02fc87b746d405ec27a68f0.png)

1800帧 = 30秒（可以设置时间长一点，但是不要超过5000，会影响计算速度）

### 类型 - 两点式

两点式被 窗口、按钮组、图片 等相关插件频繁使用。

其最大的特点就是时间固定，并且最终时间一定会到达终止点。

#### 1) 不移动

不移动指：指定的对象仍然会保持在起始点，永远 不会 到目标点。

不移动就是字面意思上的真的不移动。

![](media/b70ce0f56e295ef3c3b1f33f76793370.png)

窗口设置不移动时，通常偏移的 坐标 也需要置零。

因为如果没置零，会造成窗口长期停滞在 起始点 ，而不是在原位置。

![](media/207b861c159f20e243f49ef5027f5e0f.png)

#### 2) 瞬间移动

瞬间移动顾名思义，瞬间移动到目标点。

（设置匀速移动，移动时间为1帧，与瞬间移动的原理是一样的。）

![](media/b0996eb07b4d1103e15e9c4fb0ecf2c0.png)

注意，插件指令执行 并不能立刻到达目标点，需要1帧的准备时间。

因此，执行瞬间移动的指令时，需要等待一帧。

![](media/3fdecbc5384f40d0acaacac80f5cbefd.png)

#### 3) 匀速移动

匀速移动根据 已知路径 除以 已知时间 得到速度。

![](media/9ae5331046ad2cd482fdaa03a8eaaa8e.png)

#### 4) 增减速移动

增减速移动中，路程被分为两个部分，前半部分是匀加速，后半部分是匀减速。

![](media/3fa3ce925df0ae4b0814a5ecfce30733.png)

#### 5) 弹性移动

弹性移动实际上就是是有初速度的匀减速移动，只是这种移动看起来更加自然而已。

![](media/d65ab1954fee2431a04e0bb0c0bd2a2c.png)

#### 6) 抛物线移动

抛物线移动会额外受到 初速度+方向 的影响，但最终一定会到达目标点。

如果方向与目标点一致，则效果为匀加速运动。

![F:\\rpg mv箱\\ddd.png](media/cc3ccbc94a91161f390009c372012601.png)

![F:\\rpg mv箱\\ddd2.png](media/94245862270c21f1daffbab53067e9a7.png)

注意，粒子到达终止点后，终止点的速度绝对值一般都会比起始点的速度绝对值大。也就是说，如果持续进行抛物线移动，那么甩动的轨迹会越来越大。

## 数学公式

### 公式关系

具体公式脚本，你可以直接打开Core_Of_Ballistics.js 脚本进行查看学习哦。

#### 可用变量与常量

**变量**：是指在游戏中，随时变化的量。

可以简单理解为：插件指令调用，设置的数字，就是变量。

**常量**：是指在游戏编辑器中，配置的固定的量，在游戏中不会变化。

可以简单理解为：打开插件配置，然后你在配置里面设置了一个固定的值。

速度、加速度等设定，都是通过路程计算公式配置的。

无论是极坐标模式，还是直角坐标模式，路程都决定了粒子**最终所在的位置**。

#### 直接写数字常量

**直接写数字常量**：如果你使用的是公式，那么可以直接写数字代替常量，因为常量只是一个可扩展编辑的量，在游戏中不会变化。

举个例子，速度公式如下：

|  var result = p.v0 \* p.time; //（速度x时间）  return result; |
|---------------------------------------------------------------|

如果你在配置中写了初速度:5.0，

![](media/d8473725792dbaaac7b8816e94e15a14.png)

那么与你写的下面的自定义公式是完全一样的：

|  var result = 5 \* p.time; //（速度x时间）  return result; |
|------------------------------------------------------------|

注意，p.time不能写成数字，因为在游戏中是实时变化的量。

如果公式中没有变量，那么这个粒子将持续固定在一个具体的位置。

### 路程计算公式

#### 可用变量与常量

**变量**：是指在游戏中，随时变化的量。

**常量**：是指在游戏编辑器中，配置的固定的量，在游戏中不会变化。

| 变量名  | 中文名     | 取值范围                      | 描述                                          |
|---------|------------|-------------------------------|-----------------------------------------------|
| p.index | 粒子序号值 | 整数，0 至 p.num-1值          | 粒子定义的Id序号值。                          |
| p.time  | 时间值     | 整数，0 至 游戏中设定的时间值 | 移动的时间范围值。                            |
| p.ran   | 随机值     | 小数，0.0 至 1.0 范围随机值   | 插件内部的可控随机值，不建议用Math.random()。 |
| p.num   | 粒子数量   | 整数，游戏中设定的粒子数量    | 游戏中设定的粒子数量。                        |

| 常量名 | 中文名   | 说明                         |
|--------|----------|------------------------------|
| p.v0   | 初速度   | 无特殊规定。                 |
| p.wave | 波动量   | 一般该常量与随机值一起使用。 |
| p.a    | 加速度   | 无特殊规定。                 |
| p.vMax | 最大速度 | 无特殊规定。                 |
| p.vMin | 最小速度 | 无特殊规定。                 |

公式关系说明可以看前面章节：[公式关系](#公式关系) 。

![](media/33d9275cfab0c4a4d340f3a7dae5f6bf.png)

**  
**

#### 公式：只初速度

众所周知，r = v\*t，路程=时间\*速度。

匀速运动的情况最简单，长方形面积就是路程。

![](media/a2bbd82ddafb662bffde383b5e567a6b.png)

只初速度的v-t图

公式如下：

用到了 变量 p.time，常量 p.v0 。

|  var result = p.v0 \* p.time; //（速度x时间）  return result; |
|---------------------------------------------------------------|

#### 公式：初速度+波动量

波动量是指，初速度有一定的随机性，可以在上下进行浮动。

简单来说，就是在初速度公式上，额外增加一个波动变化的量。

在出现大量粒子时，通过波动量能够有效让他们散开。

![](media/d46d41a8ec93418885b362e932671338.png)

初速度+波动量的v-t图

公式如下：

用到了 变量 p.time/p.ran，常量 p.v0/p.wave 。

|  var v_ran = p.wave \* (p.ran - 0.5); //（根据波动量，算出波动速度）  var result = (p.v0 + v_ran) \* p.time; //（随机速度x时间）  return result; |
|--------------------------------------------------------------------------------------------------------------------------------------------------|

需要注意的是，如果vRan波动量比v0初速度还大，那么就会出现速度为负值的情况。

速度为负，则会朝 相反 的方向移动。

![](media/22764163174ef2708a51af7501a26fd0.png)

初速度+波动量的v-t图

#### 公式：初速度+波动量+加速度

匀加速运动的公式为：r=vt+½at²，也就是图中的长方形和三角形的和。

v0为初速度，a为加速度，time为时间。

则图中的v1=v0+a\*time。

则公式为： **v0\*time+0.5\*a\*time\*time**

![](media/b87d0c7251ffb0a2f94cdeff8bba158f.png)

初速度+波动量+加速度的v-t图

公式如下：

用到了 变量 p.time/p.ran，常量 p.v0/p.wave/p.a 。

|  var v_ran = p.wave \* (p.ran - 0.5); //（根据波动量，算出波动速度）  var result = (p.v0 + v_ran) \* p.time + 0.5 \* p.a \*p.time\*p.time;   return result; |
|-------------------------------------------------------------------------------------------------------------------------------------------------------------|

（如果你熟悉js的一些数学函数用法，也可以使用 Math.pow(time,2) 表示时间的平方 ）

如果出现 速度v0 为负数情况，公式依然成立。

你将会看到一个粒子逐渐停下，然后朝反方向持续加速的过程。

![](media/28d91668b0db9c2b3f0c87f38e9dba1f.png)

初速度+波动量+加速度的v-t图

#### 公式：初速度+波动量+加速度+最大最小

最大速度和最小速度是一个十分特殊的情况。

它会将速度变化分成多段。

如果速度超出了最大速度，那么就**减去**vMax多出的面积。

如果速度低于了最小速度，那么就**加上**vMin多出的面积。

![](media/7b32fc2f7088198e9a037b8b94e0e8f6.png)

最大速度切割v-t图

![](media/83b2ce40df0a226a88955a84d0f62eec.png)

最小速度切割v-t图

![](media/969919fbd3853342c00b55390c2a0e72.png)

最大最小速度组合切割的v-t图

v0为初速度，a为加速度，time为时间，vMax为最大速度，vMin为最小速度。

公式如下：

用到了 变量 p.time/p.ran，常量 p.v0/p.wave/p.a/p.vMax/p.vMin 。

|  var v_ran = p.wave \* (p.ran - 0.5); //（根据波动量，算出波动速度）    // \> 加速度公式  var v1 = (p.v0 + v_ran) + p.a \* p.time;   var d = (p.v0 + v_ran)\*p.time + 0.5 \* p.a \*p.time\*p.time;  var result = d;    // \> 分段函数（超过上限/下限，将减去多出的路程值）  if( v1 \>= p.vMax ){  var m_v = v1 - p.vMax;  var m_t = (v1 - p.vMax) / p.a;  result = d - m_v\*m_t + 0.5 \* p.a \*m_t\*m_t;  }  if( v1 \<= p.vMin ){  var m_v = v1-p.vMin;  var m_t = (v1-p.vMin)/a;  result = d - m_v\*m_t + 0.5 \* p.a \*m_t\*m_t;  }  return result; |
|------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|

#### 自定义公式

当你使用自定义公式时，之前提及的常量（见[可用变量与常量](#可用变量与常量)）都可以加入设计，

你甚至可以作为其他特殊的参数进行使用。

举个例子，你写了下面的公式：

|  var result = p.v0 \* p.v0 \* p.time \* p.id;   return result; |
|----------------------------------------------------------------|

公式中用到了 p.v0常量，那么，

配置类型为：路程计算公式，配置初速度为：5.0

![](media/d8473725792dbaaac7b8816e94e15a14.png)

在公式中，将会等价于：

var result = 5.0 \* 5.0 \* p.time \* p.id

你所写自定义公式的 p.v0 真实含义 可能并不表示“初速度”的意思，

但是该参数的确可以作为一个配置值来使用。

注意，设计公式时，常量是最后再考虑加的参数，设计公式时，不要把变量和常量放一起写，会把自己绕晕。

### 方向计算公式

#### 可用变量与常量

**变量**：是指在游戏中，随时变化的量。

**常量**：是指在游戏编辑器中，配置的固定的量，在游戏中不会变化。

| 变量名  | 中文名     | 取值范围                      | 描述                                          |
|---------|------------|-------------------------------|-----------------------------------------------|
| p.index | 粒子序号值 | 整数，0 至 p.num-1值          | 粒子定义的Id序号值。                          |
| p.time  | 时间值     | 整数，0 至 游戏中设定的时间值 | 移动的时间范围值。                            |
| p.ran   | 随机值     | 小数，0.0 至 1.0 范围随机值   | 插件内部的可控随机值，不建议用Math.random()。 |
| p.num   | 粒子数量   | 整数，游戏中设定的粒子数量    | 游戏中设定的粒子数量。                        |

| 常量名    | 中文名   | 描述         |
|-----------|----------|--------------|
| p.d0      | 固定方向 | 无特殊规定。 |
| p.sFace   | 扇形朝向 | 无特殊规定。 |
| p.sDegree | 扇形范围 | 无特殊规定。 |

公式关系说明可以看前面章节：[公式关系](#公式关系) 。

![](media/7121626b9323cae57ec255dc7007426a.png)

#### 公式：固定方向

指定一个方向，就是一个方向，不会改变。

由于没有改变的成分，所以只用到了常量。

注意，如果你同时发射10个子弹，这10个子弹的 方向
都会重叠在一起，如果其速度配置也没有随机波动量散开，那么将只看到1个子弹。

公式如下：

用到了 变量 无， 常量 p.d0 。

|  var result = p.d0; //（固定方向）  return result; |
|----------------------------------------------------|

#### 公式：四周扩散

**1) 四周扩散（线性）**

将一整个圈，按粒子数量平均划分方向值。

![](media/6f9ca0d220b8e423944b1894e3e41b59.png)

公式如下：

用到了 变量 p.index/p.num，常量 p.d0 。

|  var result = p.d0 + 360 \* p.index / p.num;   return result; //（在一个圆圈里，放入固定数量的粒子）  |
|-------------------------------------------------------------------------------------------------------|

**2) 四周扩散（随机）**

将一整个圈，随机划分方向值。

公式如下：

用到了 变量 p.ran，常量 p.d0。

| var result = p.d0 + 360 \* p.ran;   return result; |
|----------------------------------------------------|

**3) 四周扩散（抖动）**

抖动功能，是在固定随机方向的基础上，再进行一次随机偏移。

需要注意的是，由于Math.random 的值不可控，这会造成 重复发射/反向弹道
都不能完美复现原有的轨迹，所以尽量少用。

（这个功能其实挺鸡肋，也不知道在什么情况下用的上）

公式如下：

用到了 变量 p.ran，常量 p.d0。

|  var result = p.d0 + 360 \* p.ran + 30 \* Math.random();   return result;  |
|----------------------------------------------------------------------------|

#### 公式：扇形范围方向

**1) 扇形范围方向（线性）**

扇形范围，是指以朝向为基准，向两侧撑开的扇形结构。

注意，扇形范围方向，与 p.d0 固定方向的参数没有任何关系。

![](media/6b64da4ff6b8a07246693ab204f41751.png)

![](media/d2533e3f700867c72de29bdb906fe952.png)

线性的扇形范围需要区分 只一个粒子 和 有两个或以上 的粒子情况。

单独一个粒子时，发射的朝向就是 扇形朝向 。

公式如下：

用到了 变量 p.index/p.num，常量 p.sFace/p.sDegree 。

|  var result = p.sFace;   if( p.num \> 1 ){  result = p.sFace + p.sDegree \* p.index / (p.num - 1) - p.sDegree/2;  }else{  result = p.sFace;  }   return result; |
|-----------------------------------------------------------------------------------------------------------------------------------------------------------------|

**2) 扇形范围方向（随机）**

随机的扇形范围，就不需要考虑粒子数量问题了。

公式如下：

用到了 变量 p.ran，常量 p.sFace/p.sDegree 。

| var result = p.sFace + p.sDegree \* (p.ran - 0.5);  //（根据p.sDegree，算出波动范围方向，与朝向相加即可）  return result; |
|---------------------------------------------------------------------------------------------------------------------------|

#### 自定义公式

当你使用自定义公式时，之前提及的常量（见[可用变量与常量](#可用变量与常量-1)）都可以加入设计，

你甚至可以作为其他特殊的参数进行使用。

举个例子，你写了下面的公式：

|  var result = p.d0 \* p.d0 \* p.time \* p.id;   return result; |
|----------------------------------------------------------------|

公式中用到了 p.d0常量，那么，

配置类型为：方向计算公式，配置固定方向为：0.8

![](media/ebcd9e66b29220b3a518962051facb82.png)

在公式中，将会等价于：

var result = 0.8 \* 0.8 \* p.time \* p.id

你所写自定义公式的 p.d0 真实含义 可能并不表示“固定方向”的意思，

但是该参数的确可以作为一个配置值来使用。

注意，设计公式时，常量是最后再考虑加的参数，设计公式时，不要把变量和常量放一起写，会把自己绕晕。

## 组合公式效果

### 抛物线运动

抛物线是最常用的效果了。

运动轨迹分为x轴和y轴两个方向。（极坐标也可以表示，但是公式比较复杂。）

原理不难理解，举个例子：**平抛运动**（高一物理）

下图中，一个球向一个方向匀速抛出，但是球本身受到 重力加速度
的影响，可以形成一个弧线轨迹。

也就是说，x轴匀速，y轴加速运动，就可以形成抛物线。

![](media/1fd8523d441ee4c961296d0d436551ba.png)

由于平抛运动的y轴初速度是0，所以是一个一直向下的抛物线。

如果y轴初速度是负数，那么可以形成先向上，再向下的抛物线轨迹。

比如 子插件 地图UI-漂浮参数数字 配置抛物线弹道后，实现的喷泉抛物线。

![](media/c3b96b862010de014f641525142d7250.png)![](media/be256f77757d85df7b04ffa00a37f728.png)

![](media/da73b19bc84664a4fa7413d002d3c1a6.png)

### 间隔改变方向运动

### 逆时针圆周运动
